TbFinalStep8 = spark.sql("SELECT A.DTA_REFERENCIA, 
						         A.Contrato_Operacao, 
						         A.Tipo, 
						         A.Contraparte, 
						         A.Cnpj, 
						         A.Natureza, 
						         A.MesHora, 
						         A.MWm, 
						         A.MWh, 
						         A.Ano_Mes, 
						         A.Periodo, 
						         A.Energia, 
						         A.Submercado, 
						         A.Preco, 
						         A.JOIN, 
						         A.UF, 
						         A.DTA_OPERACAO, 
						         A.FLEX_MAX, 
						         A.FLEX_MIN, 
						         A.Periodo, 
						         A.EXTENSAO, 
						         A.RowId, 
						         A.valor, 
						         A.FontePreco, 
		                         A.SERIE, 
                        		 A.DIABASE, 
                        		 A.RECORRENTE, 
                        		 A.FLAG_ISENCAO, 
                        		 A.NumNotaFiscal, 
                        		 A.NumDocumento, 
                        		 A.PRECO_BASE, 
						         A.DTA_REF, 
						         A.C_M0, 
						         A.C_M1, 
						         A.C_M2, 
						         A.C_M3, 
						         A.C_A0, 
						         A.C_A1, 
						         A.C_A2, 
						         A.C_A3, 
						         A.C_A4, 
						         A.I_M0, 
						         A.I_M1, 
						         A.I_M2, 
						         A.I_M3, 
						         A.I_A0, 
						         A.I_A1, 
						         A.I_A2, 
						         A.I_A3, 
						         A.I_A4, 
						         A.CURVA_PLD, 
						         A.MAX_DATA, 
						         DT_INI.DT_INI_DataVigencia, 
						         DT_FIM.DT_FIM_DataVigencia 
						  FROM TAB_FINAL_STEP7 AS A 
						  LEFT JOIN TAB_FINAL_STEP8_INI AS DT_INI ON TO_DATE(SUBSTR(DT_INI.MAX_DATA ,0,10), 'yyyy-MM-dd') = TO_DATE(SUBSTR(A.MAX_DATA ,0,10), 'yyyy-MM-dd') AND DT_INI.Periodo = A.Periodo 
						  LEFT JOIN TAB_FINAL_STEP8_FIM AS DT_FIM ON DT_FIM.Periodo = A.Periodo AND TO_DATE(SUBSTR(DT_FIM.MAX_DATA ,0,10), 'yyyy-MM-dd') = TO_DATE(SUBSTR(A.MAX_DATA ,0,10), 'yyyy-MM-dd') ")
